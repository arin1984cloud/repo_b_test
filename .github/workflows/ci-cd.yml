name: CI/CD for Repo A

on:
  repository_dispatch:
    types: [run-ci-cd]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: debug secret
        run: |
          if [ -z "${{ secrets.REPO_A_TOKEN }}" ]; then
            echo "‚ùå REPO_A_TOKEN is missing"
          else
            echo "‚úÖ REPO_A_TOKEN is set"
          fi
      - name: Get SHA values from payload test
        run: |
          echo "Base SHA: ${{ github.event.client_payload.base_sha }}"
          echo "Head SHA: ${{ github.event.client_payload.head_sha }}"

          BASE_SHA = ${{ github.event.client_payload.base_sha }}
          HEAD_SHA = ${{ github.event.client_payload.head_sha }}

          echo "üîç Checking changes between $BASE_SHA and $HEAD_SHA"
          
      # (Optional) Checkout Repo B if you need its code
      - name: Checkout Repo B
        uses: actions/checkout@v4

      # Checkout Repo A at the commit SHA received
      - name: Checkout Repo A
        uses: actions/checkout@v4
        with:
          repository: arin1984cloud/repo_a_test
          ref: ${{ github.event.client_payload.ref }}
          token: ${{ secrets.REPO_A_TOKEN }}
          path: repo_a_test

      - name: Verify Repo A contents
        run: |
          echo "Checked out Repo A commit ${{ github.event.client_payload.ref }}"
          ls -R repo_a_test | head -20

      # Run Repo A‚Äôs CI/CD logic here
      - name: Run CI/CD for Repo A
        working-directory: repo_a_test
        run: |
          echo "Running CI/CD pipeline for Repo A"
          # example: npm ci && npm test
          # or: mvn clean install
